<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Nuit-Info Optimizer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; }
    ul { list-style: none; padding: 0; }
    li {
      background: white;
      margin: 5px 0;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    a {
      text-decoration: none;
      color: #007bff;
      cursor: pointer;
    }
    a:hover {
      text-decoration: underline;
    }
    .report-container {
      margin-top: 20px;
      padding: 10px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    pre {
      overflow-x: auto;
      background: #eee;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    button.download {
      margin-top: 10px;
      padding: 6px 12px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    button.download:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>Dashboard Nuit-Info Optimizer</h1>

  <h2>Rapports disponibles :</h2>
  <ul>
    {% for file in reports %}
      <li>
        <a data-file="{{ file }}">{{ file }}</a>
      </li>
    {% else %}
      <li>Aucun rapport disponible</li>
    {% endfor %}
  </ul>

  <div class="report-container" id="report-detail" style="display:none;">
    <h2>Détails du rapport :</h2>
    <pre id="report-json"></pre>
    <button class="download" id="download-btn">Télécharger le rapport</button>
  </div>

  <script>
    const links = document.querySelectorAll('ul li a');
    const container = document.getElementById('report-detail');
    const pre = document.getElementById('report-json');
    const downloadBtn = document.getElementById('download-btn');

    let currentFile = null;

    links.forEach(link => {
      link.addEventListener('click', async e => {
        e.preventDefault();
        const file = link.dataset.file;  // e.g. "w3schools.com.json"
        const url = `/report/${file}`;

        currentFile = file;              // store current file for download
        pre.textContent = 'Chargement...';
        container.style.display = 'block';

        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error('Erreur réseau');
          const data = await res.json();
          pre.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          pre.textContent = 'Erreur lors du chargement du rapport';
        }
      });
    });

    // Download JSON report
    downloadBtn.addEventListener('click', () => {
      if (!currentFile) return;
      fetch(`/report/${currentFile}`)
        .then(res => res.blob())
        .then(blob => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = currentFile;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });
    });
  </script>
</body>
</html>
